# 修复存档管理混乱问题

## 问题分析
当前存档管理存在以下问题：
1. 存档数据在localStorage中存储的是转换后的格式，不是原始ZOD格式
2. 导入时数据会被转换，导致导出格式与导入格式不一致
3. 导出时从实例对象生成数据，而不是直接从localStorage读取
4. 存档数据的"真相"不明确，实例对象和转换后的格式混淆

## 修复方案

### 1. 数据结构重构
- 在save.store.ts中添加`rawSaves`状态，用于存储原始ZOD格式数据
- 保持`rawSaves`与localStorage中的数据完全一致
- `saves`状态仅用于存储运行时实例，从`rawSaves`生成

### 2. 加载流程修改
- 修改`loadFromStorage`方法：直接读取localStorage中的原始ZOD格式数据到`rawSaves`
- 对每个原始ZOD数据调用`SaveData.fromZod`生成运行时实例，存储到`saves`

### 3. 保存流程修改
- 修改`saveToStorage`方法：直接将`rawSaves`写入localStorage，不再转换格式
- 确保`rawSaves`与localStorage中的数据完全一致

### 4. 导入流程修改
- 修改`importZodData`方法：直接将ZOD格式数据存储到`rawSaves`
- 调用`SaveData.fromZod`生成运行时实例，存储到`saves`
- 设置当前存档名称

### 5. 导出流程修改
- 修改`exportSaveData`方法：直接从`rawSaves`读取原始ZOD格式数据，不使用实例对象
- 修改`exportAllSaves`方法：直接将`rawSaves`转换为普通对象导出
- 确保导出格式与导入格式完全一致

### 6. 实例同步机制
- 运行时实例的修改需要同步回`rawSaves`中的原始ZOD格式数据
- 例如：修改角色装备时，同时更新`rawSaves`中对应角色的`equippedDiscs`和`equippedWengine`字段

### 7. Store API调整
- 添加`rawSaves`到Store返回值，以便调试组件查看原始JSON
- 修改`currentSave` getter，在存档切换时从`rawSaves`重新生成实例
- 修改`reset`方法，清空`rawSaves`和`saves`，并清除localStorage

### 8. 错误处理
- 在`loadFromStorage`和`importZodData`中添加错误处理，记录错误但继续处理其他存档
- 在`saveToStorage`中添加异常处理，确保数据一致性

## 实现步骤

1. 修改`save.store.ts`，添加`rawSaves`状态和相关方法
2. 修改`SaveData`类，优化`fromZod`方法，确保从ZOD格式正确生成实例
3. 调整存档操作方法，确保`rawSaves`与实例对象的同步
4. 修改导入导出方法，确保直接使用`rawSaves`
5. 添加错误处理和数据验证
6. 测试修复效果，确保导入导出格式一致

## 预期效果

1. 导入ZOD格式数据后，`rawSaves`中即刻可见相同JSON
2. 导出数据与导入数据格式完全一致（除了可选辅助字段）
3. 修改装备等操作后，`rawSaves`中对应字段同步更新
4. 刷新页面后，从localStorage加载的数据与之前的操作一致
5. 多存档切换时，每次切换都从当前raw JSON重新生成实例

这个修复方案将完全按照用户的设计要求实现，确保存档管理的清晰性和数据一致性。
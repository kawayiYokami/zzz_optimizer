# 修复存档系统实现

## 问题分析
1. **缺少 rawSaves 存储**：当前实现没有专门存储原始 Zod 数据的机制
2. **导出逻辑不符合设计**：`exportAsZod()` 和 `exportAllSaves()` 从实例转换导出，而非直接从 localStorage 读取
3. **导入后保存格式问题**：导入后调用 `saveToStorage()` 会将实例转换为 Zod 格式，可能导致与导入前格式不一致
4. **实例与原始数据同步问题**：修改装备时没有直接更新原始 Zod 数据

## 修复计划

### 1. 调整 Save Store 状态管理
- 新增 `rawSaves` 状态，用于存储原始 Zod 数据
- 修改 `loadFromStorage()` 方法，直接将原始数据保存到 `rawSaves`
- 修改 `saveToStorage()` 方法，直接将 `rawSaves` 保存到 localStorage

### 2. 修复导入流程
- 修改 `importZodData()` 方法，直接将原始 Zod 数据保存到 `rawSaves`
- 然后调用 `SaveData.fromZod()` 创建实例，保存到 `saves`
- 不再调用 `saveToStorage()`，避免修改原始数据

### 3. 修复导出流程
- 修改 `exportAsZod()` 方法，直接从 `rawSaves` 或 localStorage 读取数据导出
- 修改 `exportAllSaves()` 方法，直接从 `rawSaves` 或 localStorage 读取数据导出
- 确保所有导出方法都直接使用原始数据，而非从实例转换

### 4. 实现实例同步逻辑
- 在修改装备等操作时，同时更新 `rawSaves` 中的对应数据
- 然后调用 `saveToStorage()` 将更新后的 `rawSaves` 保存到 localStorage
- 确保 `rawSaves` 始终与实例状态保持同步

### 5. 调整 SaveData 类
- 确保 `toZodData()` 方法生成的格式与原始 Zod 格式一致
- 增强 `fromZod()` 方法，确保能正确处理原始 Zod 数据

### 6. 更新 Store API
- 新增 `rawSaves` 返回值，以便调试组件查看原始 JSON
- 确保 `currentSave` getter 在切换存档时能正确生成实例

## 预期效果
1. 导入导出的存档格式完全一致
2. localStorage 中始终保存原始 Zod 格式数据
3. 导出直接从 localStorage 读取，符合设计要求
4. 修改装备等操作时，原始数据会同步更新
5. 切换存档时，根据当前原始数据重新生成实例

## 实现步骤
1. 修改 `save.store.ts`，添加 `rawSaves` 状态和相关逻辑
2. 修复 `importZodData()` 方法，直接保存原始数据
3. 修复 `exportAsZod()` 和 `exportAllSaves()` 方法，直接使用原始数据
4. 实现装备修改时更新原始数据的逻辑
5. 测试导入导出功能，确保格式一致
6. 测试存档切换功能，确保实例正确生成
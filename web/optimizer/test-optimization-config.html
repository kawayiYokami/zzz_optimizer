<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¼˜åŒ–é…ç½®åŠŸèƒ½æµ‹è¯•</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #4ec9b0;
      border-bottom: 2px solid #4ec9b0;
      padding-bottom: 10px;
    }
    .test-section {
      background: #252526;
      border: 1px solid #3e3e42;
      border-radius: 4px;
      padding: 15px;
      margin: 15px 0;
    }
    .test-title {
      color: #569cd6;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .test-result {
      margin: 5px 0;
      padding: 5px;
    }
    .pass {
      color: #4ec9b0;
    }
    .fail {
      color: #f48771;
    }
    .info {
      color: #ce9178;
    }
    .summary {
      background: #2d2d30;
      border: 2px solid #4ec9b0;
      border-radius: 4px;
      padding: 20px;
      margin-top: 30px;
      font-size: 18px;
    }
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #1177bb;
    }
    button:disabled {
      background: #3e3e42;
      cursor: not-allowed;
    }
    pre {
      background: #1e1e1e;
      border: 1px solid #3e3e42;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª ä¼˜åŒ–é…ç½®åŠŸèƒ½æµ‹è¯•</h1>

    <div>
      <button id="runTests">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
      <button id="clearResults">æ¸…é™¤ç»“æœ</button>
    </div>

    <div id="testResults"></div>
  </div>

  <script type="module">
    // å¯¼å…¥æµ‹è¯•æ¨¡å—
    import { runTests } from './src/tests/optimization-config.test.ts';

    const resultsDiv = document.getElementById('testResults');
    const runButton = document.getElementById('runTests');
    const clearButton = document.getElementById('clearResults');

    // é‡å†™ console.log ä»¥æ•è·è¾“å‡º
    const originalLog = console.log;
    let testOutput = [];

    function captureConsole() {
      testOutput = [];
      console.log = function(...args) {
        testOutput.push(args.join(' '));
        originalLog.apply(console, args);
      };
    }

    function restoreConsole() {
      console.log = originalLog;
    }

    function formatOutput(output) {
      let html = '';
      let currentSection = null;

      output.forEach(line => {
        if (line.includes('='.repeat(60))) {
          // åˆ†éš”çº¿
          html += '<hr style="border-color: #3e3e42; margin: 20px 0;">';
        } else if (line.includes('ã€æµ‹è¯•')) {
          // æµ‹è¯•æ ‡é¢˜
          if (currentSection) {
            html += '</div>';
          }
          currentSection = true;
          html += '<div class="test-section">';
          html += `<div class="test-title">${line}</div>`;
        } else if (line.includes('âœ“ æµ‹è¯•ç»“æœ:')) {
          // æµ‹è¯•ç»“æœ
          const isPassed = line.includes('é€šè¿‡');
          const className = isPassed ? 'pass' : 'fail';
          html += `<div class="test-result ${className}">${line}</div>`;
        } else if (line.includes('é€šè¿‡:') || line.includes('å¤±è´¥:')) {
          // æ±‡æ€»ä¿¡æ¯
          html += `<div class="test-result info">${line}</div>`;
        } else if (line.includes('âœ…') || line.includes('âŒ')) {
          // æœ€ç»ˆç»“æœ
          const isPassed = line.includes('âœ…');
          const className = isPassed ? 'pass' : 'fail';
          html += `<div class="summary ${className}">${line}</div>`;
        } else if (line.trim()) {
          // æ™®é€šè¾“å‡º
          html += `<div class="test-result">${line}</div>`;
        }
      });

      if (currentSection) {
        html += '</div>';
      }

      return html;
    }

    runButton.addEventListener('click', async () => {
      runButton.disabled = true;
      resultsDiv.innerHTML = '<div class="info">æ­£åœ¨è¿è¡Œæµ‹è¯•...</div>';

      try {
        captureConsole();
        await runTests();
        restoreConsole();

        resultsDiv.innerHTML = formatOutput(testOutput);
      } catch (error) {
        restoreConsole();
        resultsDiv.innerHTML = `<div class="fail">æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}</div><pre>${error.stack}</pre>`;
      } finally {
        runButton.disabled = false;
      }
    });

    clearButton.addEventListener('click', () => {
      resultsDiv.innerHTML = '';
    });

    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
    resultsDiv.innerHTML = `
      <div class="test-section">
        <div class="test-title">æµ‹è¯•è¯´æ˜</div>
        <div class="test-result info">
          æœ¬æµ‹è¯•é¡µé¢ç”¨äºéªŒè¯ä¼˜åŒ–é…ç½®åŠŸèƒ½çš„æ­£ç¡®æ€§ï¼ŒåŒ…æ‹¬ï¼š
        </div>
        <ul style="color: #ce9178;">
          <li>è§’è‰²ç±»å‹åˆ†æå’Œæ¨èè¯æ¡</li>
          <li>æ™ºèƒ½é…ç½®ç”Ÿæˆ</li>
          <li>é…ç½®æ¥æºè¯†åˆ«</li>
          <li>é»˜è®¤é…ç½®æ£€æµ‹</li>
        </ul>
        <div class="test-result info">
          ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"æŒ‰é’®å¼€å§‹æµ‹è¯•ã€‚
        </div>
      </div>
    `;
  </script>
</body>
</html>

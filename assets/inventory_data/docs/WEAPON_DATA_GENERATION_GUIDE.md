# æ­¦å™¨æ•°æ®ç”ŸæˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•ä»åŸå§‹æ­¦å™¨æ•°æ®ï¼ˆ`assets/inventory_data/weapon/`ï¼‰ç”Ÿæˆæ ‡å‡†åŒ–çš„æ­¦å™¨æ•°æ®ï¼ˆ`assets/inventory_data/weapon_data/`ï¼‰ã€‚

**é‡è¦è¯´æ˜**ï¼š
- âœ… **åªç”Ÿæˆç‰¹æ•ˆbuffå’Œdebuff**ï¼šå¤©èµ‹æè¿°ä¸­çš„æ‰€æœ‰æ•ˆæœ
- âŒ **ä¸ç”ŸæˆåŸºç¡€å±æ€§**ï¼šbase_propertyå’Œrand_propertyå­—æ®µä¸éœ€è¦
- âœ… **åŸºç¡€å±æ€§ç›´æ¥è¯»å–åŸjson**ï¼šé€šè¿‡ `WEngine.get_stats_at_level()` æ–¹æ³•åŠ¨æ€è®¡ç®—

---

## ğŸ¯ æ•°æ®ç»“æ„è¯´æ˜

### åŸå§‹æ•°æ®ï¼ˆassets/inventory_data/weapon/ï¼‰

åŒ…å«å®Œæ•´çš„æ­¦å™¨ä¿¡æ¯ï¼š
- åŸºç¡€å±æ€§ï¼ˆBasePropertyï¼‰
- å‰¯å±æ€§ï¼ˆRandPropertyï¼‰
- ç­‰çº§æˆé•¿æ•°æ®ï¼ˆLevelï¼‰
- æ˜Ÿçº§åŠ æˆæ•°æ®ï¼ˆStarsï¼‰
- å¤©èµ‹æè¿°ï¼ˆTalentsï¼‰

### ç”Ÿæˆæ•°æ®ï¼ˆassets/inventory_data/weapon_data/ï¼‰

åªåŒ…å«ï¼š
- æ­¦å™¨åŸºæœ¬ä¿¡æ¯ï¼ˆid, name, code_name, rarity, weapon_typeï¼‰
- å¤©èµ‹æ•ˆæœï¼ˆtalents + buffsï¼‰

---

## ğŸ”§ Buffå åŠ æ¨¡å¼

### Buffæ¨¡å‹æ–°å¢å­—æ®µ

```python
@dataclass
class Buff:
    # ... åŸæœ‰å­—æ®µ ...
    target: BuffTarget  # ç”Ÿæ•ˆç›®æ ‡ï¼ˆé»˜è®¤ä»…è‡ªèº«ï¼‰

    max_stacks: int = 1              # æœ€å¤§å åŠ å±‚æ•°
    stack_mode: str = "linear"       # å åŠ æ¨¡å¼
    base_value: Optional[float] = None  # æ¯å±‚åŸºç¡€å€¼
    full_stack_bonus: Optional[float] = None  # æ»¡å±‚é¢å¤–åŠ æˆ
```

**BuffTarget ç»“æ„**ï¼š
```python
class BuffTarget:
    def __init__(
        self,
        target_self: bool = True,      # å¯¹è‡ªèº«ç”Ÿæ•ˆ
        target_enemy: bool = False,    # å¯¹æ•Œäººç”Ÿæ•ˆ
        target_teammate: bool = False, # å¯¹é˜Ÿå‹ç”Ÿæ•ˆ
        target_bund: bool = False,     # å¯¹é‚¦å¸ƒç”Ÿæ•ˆ
    )
```

**é»˜è®¤å€¼**ï¼š
- æ­¦å™¨BUFFé»˜è®¤åªå¯¹è£…å¤‡è€…è‡ªèº«ç”Ÿæ•ˆï¼š`target_self = true, target_enemy = false, target_teammate = false, target_bund = false`

**æ³¨æ„äº‹é¡¹**ï¼š
- æ­¦å™¨BUFFé€šå¸¸åªå¯¹è£…å¤‡è€…è‡ªèº«ç”Ÿæ•ˆ
- å¦‚æœå¤©èµ‹æ•ˆæœæåˆ°"æ•Œäººé˜²å¾¡é™ä½"ï¼Œåˆ™è®¾ç½® `target_enemy = true`
- å¦‚æœå¤©èµ‹æ•ˆæœæåˆ°"å…¨é˜Ÿè§’è‰²"ï¼Œåˆ™è®¾ç½® `target_teammate = true`

### å åŠ æ¨¡å¼ç±»å‹

#### 1. linearï¼ˆçº¿æ€§å åŠ ï¼‰

æ¯å±‚æä¾›å›ºå®šåŠ æˆï¼Œæ»¡å±‚æ—¶é¢å¤–åŠ æˆã€‚

**ç¤ºä¾‹**ï¼š
```json
{
  "id": "14136_talent_1_3_1",
  "name": "ç´¢é­‚å½±çœ¸-å†²å‡»åŠ›",
  "max_stacks": 3,
  "stack_mode": "linear",
  "base_value": 4.0,
  "full_stack_bonus": 8.0,
  "in_combat_stats": {
    "IMPACT_DMG_": 4.0
  }
}
```

**è®¡ç®—ç»“æœ**ï¼š
- 1å±‚ï¼š4.0 Ã— 1 = 4.0%
- 2å±‚ï¼š4.0 Ã— 2 = 8.0%
- 3å±‚ï¼š4.0 Ã— 3 + 8.0 = 20.0%

#### 2. full_onlyï¼ˆä»…æ»¡å±‚ç”Ÿæ•ˆï¼‰

åªæœ‰è¾¾åˆ°æ»¡å±‚æ‰ç”Ÿæ•ˆã€‚

**ç¤ºä¾‹**ï¼š
```json
{
  "id": "14110_talent_1_1_1",
  "name": "ç‡ƒç‹±é½¿è½®-å†²å‡»åŠ›",
  "max_stacks": 2,
  "stack_mode": "full_only",
  "in_combat_stats": {
    "IMPACT_DMG_": 10.0
  }
}
```

**è®¡ç®—ç»“æœ**ï¼š
- 1å±‚ï¼š0
- 2å±‚ï¼š10.0%

---

## âš”ï¸ å¤©èµ‹æ•ˆæœè§£æè§„åˆ™

### å¤©èµ‹æè¿°åˆ†æ

å¤©èµ‹æè¿°é€šå¸¸åŒ…å«å¤šä¸ªæ•ˆæœï¼Œéœ€è¦åˆ†åˆ«è§£æä¸ºç‹¬ç«‹çš„buffæˆ–debuffã€‚

**ç¤ºä¾‹**ï¼ˆ14136 ç´¢é­‚å½±çœ¸ï¼‰ï¼š
```
è£…å¤‡è€…çš„[è¿½åŠ æ”»å‡»]å‘½ä¸­æ•Œäººå¹¶é€ æˆç”µå±æ€§ä¼¤å®³æ—¶ï¼Œç›®æ ‡çš„é˜²å¾¡åŠ›é™ä½25%ï¼ŒæŒç»­5ç§’ï¼›
è¯¥æ•ˆæœè§¦å‘æ—¶ï¼Œå¦‚æœè‡ªèº«ä¸æ˜¯å½“å‰æ“ä½œä¸­çš„è§’è‰²ï¼Œåˆ™è£…å¤‡è€…è·å¾—1å±‚[é­‚é”]ï¼Œæœ€å¤šå åŠ 3å±‚ï¼›
æ¯å±‚[é­‚é”]ï¼Œå¯ä½¿è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡4%ï¼ŒæŒç»­12ç§’ï¼Œæ¯å±‚æ•ˆæœå•ç‹¬ç»“ç®—æŒç»­æ—¶é—´ï¼Œ
[é­‚é”]å±‚æ•°å æ»¡æ—¶ï¼Œé¢å¤–ç»™è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡8%ã€‚
```

### æ•ˆæœç±»å‹è¯†åˆ«

#### 1. Debuffï¼ˆæ•Œäººå‡ç›Šï¼‰

**è¯†åˆ«å…³é”®è¯**ï¼š
- "ç›®æ ‡çš„...é™ä½"
- "æ•Œäºº...é™ä½"
- "é˜²å¾¡åŠ›é™ä½"
- "æŠ—æ€§é™ä½"

**å±æ€§æ˜ å°„**ï¼š
| æ•ˆæœæè¿° | PropertyType | ç¤ºä¾‹å€¼ |
|---------|-------------|--------|
| "é˜²å¾¡åŠ›é™ä½XX%" | `DEF_RED_` | 25% |
| "å±æ€§æŠ—æ€§é™ä½XX%" | `ENEMY_RES_RED_` | 20% |

**ç¤ºä¾‹**ï¼š
```json
{
  "id": "14136_talent_1_1_1",
  "name": "ç´¢é­‚å½±çœ¸-å‡é˜²",
  "description": "ç›®æ ‡çš„é˜²å¾¡åŠ›é™ä½25%ï¼ŒæŒç»­5ç§’",
  "source": "WENGINE_TALENT",
  "context": "IN_COMBAT",
  "target": {
    "target_self": true,
    "target_enemy": true,
    "target_teammate": false,
    "target_bund": false
  },
  "max_stacks": 1,
  "stack_mode": "linear",
  "trigger_conditions": "è¿½åŠ æ”»å‡»å‘½ä¸­æ•Œäººå¹¶é€ æˆç”µå±æ€§ä¼¤å®³æ—¶",
  "out_of_combat_stats": {},
  "in_combat_stats": {
    "DEF_RED_": 25.0
  }
}
```

#### 2. Buffï¼ˆè‡ªèº«å¢ç›Šï¼‰

**è¯†åˆ«å…³é”®è¯**ï¼š
- "è£…å¤‡è€…çš„...æå‡"
- "è£…å¤‡è€…è·å¾—..."
- "è£…å¤‡è€…å›å¤..."

**å¸¸è§å±æ€§æ˜ å°„**ï¼š
| æ•ˆæœæè¿° | PropertyType | ç¤ºä¾‹å€¼ |
|---------|-------------|--------|
| "ä¼¤å®³æå‡XX%" | `COMMON_DMG_` | 20% |
| "ç‰©ç†ä¼¤å®³æå‡XX%" | `PHYSICAL_DMG_` | 20% |
| "ç”µå±æ€§ä¼¤å®³æå‡XX%" | `ELECTRIC_DMG_` | 20% |
| "å†²å‡»åŠ›æå‡XX%" | `IMPACT_DMG_` | 4% |
| "æš´å‡»ç‡æå‡XX%" | `CRIT_` | 6.5% |
| "å¼‚å¸¸æŒæ§æå‡XXç‚¹" | `ANOM_MAS_` | 60 |
| "èƒ½é‡è‡ªåŠ¨å›å¤æå‡XXç‚¹/ç§’" | `ENER_REGEN_` | 0.6 |

**çº¿æ€§å åŠ ç¤ºä¾‹**ï¼š
```json
{
  "id": "14136_talent_1_3_1",
  "name": "ç´¢é­‚å½±çœ¸-å†²å‡»åŠ›",
  "description": "æ¯å±‚[é­‚é”]ï¼Œå¯ä½¿è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡4%ï¼ŒæŒç»­12ç§’ï¼Œæ¯å±‚æ•ˆæœå•ç‹¬ç»“ç®—æŒç»­æ—¶é—´ï¼Œ[é­‚é”]å±‚æ•°å æ»¡æ—¶ï¼Œé¢å¤–ç»™è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡8%ã€‚",
  "source": "WENGINE_TALENT",
  "context": "IN_COMBAT",
  "target": {
    "target_self": true,
    "target_enemy": false,
    "target_teammate": false,
    "target_bund": false
  },
  "max_stacks": 3,
  "stack_mode": "linear",
  "base_value": 4.0,
  "full_stack_bonus": 8.0,
  "trigger_conditions": "",
  "out_of_combat_stats": {},
  "in_combat_stats": {
    "IMPACT_DMG_": 4.0
  }
}
```

**ä»…æ»¡å±‚ç”Ÿæ•ˆç¤ºä¾‹**ï¼š
```json
{
  "id": "14110_talent_1_1_1",
  "name": "ç‡ƒç‹±é½¿è½®-å†²å‡»åŠ›",
  "description": "å‘åŠ¨[å¼ºåŒ–ç‰¹æ®ŠæŠ€]æ—¶ï¼Œè£…å¤‡è€…çš„å†²å‡»åŠ›æå‡10%ï¼Œæœ€å¤šå åŠ 2å±‚ï¼ŒæŒç»­10ç§’ã€‚",
  "source": "WENGINE_TALENT",
  "context": "IN_COMBAT",
  "target": {
    "target_self": true,
    "target_enemy": false,
    "target_teammate": false,
    "target_bund": false
  },
  "max_stacks": 2,
  "stack_mode": "full_only",
  "trigger_conditions": "å‘åŠ¨å¼ºåŒ–ç‰¹æ®ŠæŠ€æ—¶",
  "out_of_combat_stats": {},
  "in_combat_stats": {
    "IMPACT_DMG_": 10.0
  }
}
```

### Trigger Conditionsï¼ˆè§¦å‘æ¡ä»¶ï¼‰

**é‡è¦è¯´æ˜**ï¼š
- `trigger_conditions` åº”è¯¥æ˜¯**æè¿°æ€§æ–‡æœ¬**ï¼Œä¸æ˜¯æšä¸¾å€¼
- æš‚æ—¶ä¸å®ç°trigger_conditionsçš„é€»è¾‘åˆ¤æ–­
- ä»…ç”¨äºè®°å½•æ•ˆæœçš„è§¦å‘æ¡ä»¶ï¼Œæ–¹ä¾¿åç»­ç†è§£å’Œæ‰©å±•

**ç¤ºä¾‹**ï¼š
```
"è£…å¤‡è€…çš„[è¿½åŠ æ”»å‡»]å‘½ä¸­æ•Œäººå¹¶é€ æˆ<color=#2EB6FF>ç”µå±æ€§ä¼¤å®³</color>æ—¶"
```

**æ˜ å°„**ï¼š
```json
"trigger_conditions": "è¿½åŠ æ”»å‡»å‘½ä¸­æ•Œäººå¹¶é€ æˆç”µå±æ€§ä¼¤å®³æ—¶"
```

---

## ğŸ¨ å¤šæŠ€èƒ½ä¼¤å®³æå‡çš„å¤„ç†

### å…³é”®è§„åˆ™

å½“ä¸€ä¸ªbuffåŒæ—¶æå‡å¤šä¸ªæŠ€èƒ½çš„ä¼¤å®³æ—¶ï¼Œ**åº”è¯¥å°†è¿™äº›ä¼¤å®³åŠ æˆæ”¾åœ¨åŒä¸€ä¸ªbuffçš„ `in_combat_stats` é‡Œ**ï¼Œè€Œä¸æ˜¯åˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„buffã€‚

### é”™è¯¯ç¤ºä¾‹

```json
{
  "buffs": [
    {
      "id": "12001_talent_3_1_1",
      "name": "æ™®é€šæ”»å‡»ä¼¤å®³æå‡",
      "in_combat_stats": {
        "NORMAL_ATK_DMG_": 16.0
      }
    },
    {
      "id": "12001_talent_3_1_2",
      "name": "å†²åˆºæ”»å‡»ä¼¤å®³æå‡",
      "in_combat_stats": {
        "DASH_ATK_DMG_": 16.0
      }
    },
    {
      "id": "12001_talent_3_1_3",
      "name": "é—ªé¿åå‡»ä¼¤å®³æå‡",
      "in_combat_stats": {
        "DODGE_COUNTER_DMG_": 16.0
      }
    }
  ]
}
```

### æ­£ç¡®ç¤ºä¾‹

```json
{
  "buffs": [
    {
      "id": "12001_talent_3_1_1",
      "name": "å¤šæŠ€èƒ½ä¼¤å®³æå‡",
      "description": "[æ™®é€šæ”»å‡»]ã€[å†²åˆºæ”»å‡»]ã€[é—ªé¿åå‡»]é€ æˆçš„ä¼¤å®³æå‡16%ã€‚",
      "source": "WENGINE_TALENT",
      "context": "IN_COMBAT",
      "max_stacks": 1,
      "stack_mode": "full_only",
      "trigger_conditions": "",
      "out_of_combat_stats": {},
      "in_combat_stats": {
        "NORMAL_ATK_DMG_": 16.0,
        "DASH_ATK_DMG_": 16.0,
        "DODGE_COUNTER_DMG_": 16.0
      }
    }
  ]
}
```

### è¯†åˆ«æ¨¡å¼

**å¤šæŠ€èƒ½ä¼¤å®³æå‡çš„å¸¸è§æè¿°**ï¼š
- "[æ™®é€šæ”»å‡»]ã€[å†²åˆºæ”»å‡»]ã€[é—ªé¿åå‡»]é€ æˆçš„ä¼¤å®³æå‡XX%"
- "æ™®é€šæ”»å‡»ã€å†²åˆºæ”»å‡»ã€é—ªé¿åå‡»çš„ä¼¤å®³æå‡XX%"
- "[æ™®é€šæ”»å‡»]ã€[å¼ºåŒ–ç‰¹æ®ŠæŠ€]ã€[ç»ˆç»“æŠ€]é€ æˆçš„ä¼¤å®³æå‡XX%"

**å¤„ç†è§„åˆ™**ï¼š
1. è¯†åˆ«æ‰€æœ‰è¢«æå‡çš„æŠ€èƒ½ç±»å‹
2. ä¸ºæ¯ä¸ªæŠ€èƒ½ç±»å‹æ˜ å°„åˆ°å¯¹åº”çš„ä¼¤å®³åŠ æˆå±æ€§
3. å°†æ‰€æœ‰ä¼¤å®³åŠ æˆæ”¾åœ¨åŒä¸€ä¸ªbuffçš„ `in_combat_stats` é‡Œ
4. åªåˆ›å»ºä¸€ä¸ªbuffå¯¹è±¡

---

## ğŸ“Š å®Œæ•´å±æ€§ç±»å‹æ˜ å°„è¡¨

### æŠ€èƒ½ä¼¤å®³åŠ æˆï¼ˆDamageTypeæŠ€èƒ½ç›¸å…³ï¼‰

| æè¿° | PropertyType | è¯´æ˜ |
|-----|-------------|------|
| æ™®é€šæ”»å‡»ä¼¤å®³ | `NORMAL_ATK_DMG_` | æ™®é€šæ”»å‡»é€ æˆçš„ä¼¤å®³åŠ æˆ |
| å¼ºåŒ–ç‰¹æ®ŠæŠ€ä¼¤å®³ | `ENHANCED_SPECIAL_DMG_` | å¼ºåŒ–ç‰¹æ®ŠæŠ€é€ æˆçš„ä¼¤å®³åŠ æˆ |
| è¿æºæŠ€ä¼¤å®³ | `CHAIN_ATK_DMG_` | è¿æºæŠ€é€ æˆçš„ä¼¤å®³åŠ æˆ |
| ç»ˆç»“æŠ€ä¼¤å®³ | `ULTIMATE_ATK_DMG_` | ç»ˆç»“æŠ€é€ æˆçš„ä¼¤å®³åŠ æˆ |
| å†²åˆºæ”»å‡»ä¼¤å®³ | `DASH_ATK_DMG_` | å†²åˆºæ”»å‡»é€ æˆçš„ä¼¤å®³åŠ æˆ |
| é—ªé¿åå‡»ä¼¤å®³ | `DODGE_COUNTER_DMG_` | é—ªé¿åå‡»é€ æˆçš„ä¼¤å®³åŠ æˆ |
| æ”¯æ´æ”»å‡»ä¼¤å®³ | `ASSIST_ATK_DMG_` | æ”¯æ´æ”»å‡»é€ æˆçš„ä¼¤å®³åŠ æˆ |
| è¿½åŠ æ”»å‡»ä¼¤å®³ | `ADDL_ATK_DMG_` | è¿½åŠ æ”»å‡»é€ æˆçš„ä¼¤å®³åŠ æˆ |
| ç‰¹æ®ŠæŠ€ä¼¤å®³ | `SPECIAL_ATK_DMG_` | ç‰¹æ®ŠæŠ€é€ æˆçš„ä¼¤å®³åŠ æˆ |

### å…ƒç´ ä¼¤å®³åŠ æˆï¼ˆDamageTypeå…ƒç´ ç›¸å…³ï¼‰

| æè¿° | PropertyType | è¯´æ˜ |
|-----|-------------|------|
| ç‰©ç†ä¼¤å®³ | `PHYSICAL_DMG_` | ç‰©ç†å±æ€§ä¼¤å®³åŠ æˆ |
| ä»¥å¤ªä¼¤å®³ | `ETHER_DMG_` | ä»¥å¤ªå±æ€§ä¼¤å®³åŠ æˆ |
| ç”µå±æ€§ä¼¤å®³ | `ELECTRIC_DMG_` | ç”µå±æ€§ä¼¤å®³åŠ æˆ |
| å†°å±æ€§ä¼¤å®³ | `ICE_DMG_` | å†°å±æ€§ä¼¤å®³åŠ æˆ |
| ç«å±æ€§ä¼¤å®³ | `FIRE_DMG_` | ç«å±æ€§ä¼¤å®³åŠ æˆ |

### å±æ€§å¼‚å¸¸ä¼¤å®³åŠ æˆï¼ˆDamageTypeå¼‚å¸¸ç›¸å…³ï¼‰

| æè¿° | PropertyType | è¯´æ˜ |
|-----|-------------|------|
| å¼ºå‡»ä¼¤å®³ | `IMPACT_DMG_` | å¼ºå‡»å¼‚å¸¸ä¼¤å®³åŠ æˆ |
| å‡›å†½ä¼¤å®³ | `FREEZE_DMG_` | å‡›å†½å¼‚å¸¸ä¼¤å®³åŠ æˆ |

### ç‰¹æ®Šä¼¤å®³åŠ æˆï¼ˆDamageTypeç‰¹æ®Šç›¸å…³ï¼‰

| æè¿° | PropertyType | è¯´æ˜ |
|-----|-------------|------|
| ç©¿é€ä¼¤å®³ | `PENETRATION_DMG_` | ç©¿é€ä¼¤å®³åŠ æˆ |
| ç´Šä¹±ä¼¤å®³ | `DISORDER_DMG_` | ç´Šä¹±ä¼¤å®³åŠ æˆ |
| å¼‚å¸¸ä¼¤å®³ | `ANOMALY_DMG_` | å¼‚å¸¸ä¼¤å®³åŠ æˆ |
| é€šç”¨ä¼¤å®³ | `COMMON_DMG_` | é€šç”¨ä¼¤å®³åŠ æˆï¼ˆæœªæŒ‡å®šç±»å‹æ—¶ä½¿ç”¨ï¼‰ |

### åŸºç¡€å±æ€§åŠ æˆ

| æè¿° | PropertyType | è¯´æ˜ |
|-----|-------------|------|
| æ”»å‡»åŠ›% | `ATK_` | æ”»å‡»åŠ›ç™¾åˆ†æ¯”åŠ æˆ |
| åŸºç¡€æ”»å‡»åŠ› | `ATK_BASE_` | åŸºç¡€æ”»å‡»åŠ›åŠ æˆ |
| ç”Ÿå‘½å€¼% | `HP_` | ç”Ÿå‘½å€¼ç™¾åˆ†æ¯”åŠ æˆ |
| æš´å‡»ç‡ | `CRIT_` | æš´å‡»ç‡åŠ æˆ |
| æš´å‡»ä¼¤å®³ | `CRIT_DMG_` | æš´å‡»ä¼¤å®³åŠ æˆ |
| ç©¿é€ç‡ | `PEN_` | ç©¿é€ç‡åŠ æˆ |
| å¼‚å¸¸æŒæ§% | `ANOM_MAS_` | å¼‚å¸¸æŒæ§ç™¾åˆ†æ¯”åŠ æˆ |
| å†²å‡»åŠ›% | `IMPACT_` | å†²å‡»åŠ›ç™¾åˆ†æ¯”åŠ æˆ |
| èƒ½é‡è‡ªåŠ¨å›å¤ | `ENER_REGEN_` | èƒ½é‡è‡ªåŠ¨å›å¤åŠ æˆ |
| èƒ½é‡å›å¤æ•ˆç‡ | `ENER_EFF_` | èƒ½é‡å›å¤æ•ˆç‡åŠ æˆ |

### Debuffå±æ€§

| æè¿° | PropertyType | è¯´æ˜ |
|-----|-------------|------|
| æ•Œäººé˜²å¾¡é™ä½% | `DEF_RED_` | é™ä½æ•Œäººé˜²å¾¡åŠ›ï¼ˆå‡é˜²ï¼‰ |
| æ•ŒäººæŠ—æ€§é™ä½% | `ENEMY_RES_RED_` | é™ä½æ•Œäººå±æ€§æŠ—æ€§ |

---

## ğŸ“Š å®Œæ•´ç¤ºä¾‹

### åŸå§‹æ•°æ® (14136.json)

```json
{
  "Id": 14136,
  "CodeName": "Weapon_S_1361",
  "Name": "ç´¢é­‚å½±çœ¸",
  "Rarity": 4,
  "WeaponType": {"2": "å‡»ç ´"},
  "BaseProperty": {
    "Name": "åŸºç¡€æ”»å‡»åŠ›",
    "Value": 48
  },
  "RandProperty": {
    "Name": "æš´å‡»ç‡",
    "Value": 960
  },
  "Talents": {
    "1": {
      "Name": "æ•é£å¯»è¸ª",
      "Desc": "è£…å¤‡è€…çš„[è¿½åŠ æ”»å‡»]å‘½ä¸­æ•Œäººå¹¶é€ æˆç”µå±æ€§ä¼¤å®³æ—¶ï¼Œç›®æ ‡çš„é˜²å¾¡åŠ›é™ä½25%ï¼ŒæŒç»­5ç§’ï¼›è¯¥æ•ˆæœè§¦å‘æ—¶ï¼Œå¦‚æœè‡ªèº«ä¸æ˜¯å½“å‰æ“ä½œä¸­çš„è§’è‰²ï¼Œåˆ™è£…å¤‡è€…è·å¾—1å±‚[é­‚é”]ï¼Œæœ€å¤šå åŠ 3å±‚ï¼›æ¯å±‚[é­‚é”]ï¼Œå¯ä½¿è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡4%ï¼ŒæŒç»­12ç§’ï¼Œæ¯å±‚æ•ˆæœå•ç‹¬ç»“ç®—æŒç»­æ—¶é—´ï¼Œ[é­‚é”]å±‚æ•°å æ»¡æ—¶ï¼Œé¢å¤–ç»™è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡8%ã€‚"
    }
  }
}
```

### ç”Ÿæˆæ•°æ® (14136.json)

```json
{
  "wengine_id": "14136",
  "code_name": "Weapon_S_1361",
  "name": "ç´¢é­‚å½±çœ¸",
  "rarity": 4,
  "weapon_type": "å‡»ç ´",
  "talents": [
    {
      "level": 1,
      "name": "æ•é£å¯»è¸ª",
      "description": "è£…å¤‡è€…çš„[è¿½åŠ æ”»å‡»]å‘½ä¸­æ•Œäººå¹¶é€ æˆç”µå±æ€§ä¼¤å®³æ—¶ï¼Œç›®æ ‡çš„é˜²å¾¡åŠ›é™ä½25%ï¼ŒæŒç»­5ç§’ï¼›è¯¥æ•ˆæœè§¦å‘æ—¶ï¼Œå¦‚æœè‡ªèº«ä¸æ˜¯å½“å‰æ“ä½œä¸­çš„è§’è‰²ï¼Œåˆ™è£…å¤‡è€…è·å¾—1å±‚[é­‚é”]ï¼Œæœ€å¤šå åŠ 3å±‚ï¼›æ¯å±‚[é­‚é”]ï¼Œå¯ä½¿è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡4%ï¼ŒæŒç»­12ç§’ï¼Œæ¯å±‚æ•ˆæœå•ç‹¬ç»“ç®—æŒç»­æ—¶é—´ï¼Œ[é­‚é”]å±‚æ•°å æ»¡æ—¶ï¼Œé¢å¤–ç»™è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡8%ã€‚",
      "buffs": [
        {
          "id": "14136_talent_1_1_1",
          "name": "ç´¢é­‚å½±çœ¸-å‡é˜²",
          "description": "ç›®æ ‡çš„é˜²å¾¡åŠ›é™ä½25%ï¼ŒæŒç»­5ç§’",
          "source": "WENGINE_TALENT",
          "context": "IN_COMBAT",
          "target": {
            "target_self": true,
            "target_enemy": true,
            "target_teammate": false,
            "target_bund": false
          },
          "max_stacks": 1,
          "stack_mode": "linear",
          "trigger_conditions": "è¿½åŠ æ”»å‡»å‘½ä¸­æ•Œäººå¹¶é€ æˆç”µå±æ€§ä¼¤å®³æ—¶",
          "out_of_combat_stats": {},
          "in_combat_stats": {
            "DEF_RED_": 25.0
          }
        },
        {
          "id": "14136_talent_1_3_1",
          "name": "ç´¢é­‚å½±çœ¸-å†²å‡»åŠ›",
          "description": "æ¯å±‚[é­‚é”]ï¼Œå¯ä½¿è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡4%ï¼ŒæŒç»­12ç§’ï¼Œæ¯å±‚æ•ˆæœå•ç‹¬ç»“ç®—æŒç»­æ—¶é—´ï¼Œ[é­‚é”]å±‚æ•°å æ»¡æ—¶ï¼Œé¢å¤–ç»™è£…å¤‡è€…çš„å†²å‡»åŠ›æå‡8%ã€‚",
          "source": "WENGINE_TALENT",
          "context": "IN_COMBAT",
          "target": {
            "target_self": true,
            "target_enemy": false,
            "target_teammate": false,
            "target_bund": false
          },
          "max_stacks": 3,
          "stack_mode": "linear",
          "base_value": 4.0,
          "full_stack_bonus": 8.0,
          "trigger_conditions": "",
          "out_of_combat_stats": {},
          "in_combat_stats": {
            "IMPACT_DMG_": 4.0
          }
        }
      ]
    }
  ]
}
```

### å¤šæŠ€èƒ½ä¼¤å®³æå‡ç¤ºä¾‹ (12001.json)

```json
{
  "wengine_id": "12001",
  "code_name": "Weapon_S_0011",
  "name": "ã€Œæœˆç›¸ã€-æœ›",
  "rarity": 2,
  "weapon_type": "æ”»å‡»",
  "talents": [
    {
      "level": 3,
      "name": "æ»¡æœˆ",
      "description": "[æ™®é€šæ”»å‡»]ã€[å†²åˆºæ”»å‡»]ã€[é—ªé¿åå‡»]é€ æˆçš„ä¼¤å®³æå‡16%ã€‚",
      "buffs": [
        {
          "id": "12001_talent_3_1_1",
          "name": "å¤šæŠ€èƒ½ä¼¤å®³æå‡",
          "description": "[æ™®é€šæ”»å‡»]ã€[å†²åˆºæ”»å‡»]ã€[é—ªé¿åå‡»]é€ æˆçš„ä¼¤å®³æå‡16%ã€‚",
          "source": "WENGINE_TALENT",
          "context": "IN_COMBAT",
          "target": {
            "target_self": true,
            "target_enemy": false,
            "target_teammate": false,
            "target_bund": false
          },
          "max_stacks": 1,
          "stack_mode": "full_only",
          "trigger_conditions": "",
          "out_of_combat_stats": {},
          "in_combat_stats": {
            "NORMAL_ATK_DMG_": 16.0,
            "DASH_ATK_DMG_": 16.0,
            "DODGE_COUNTER_DMG_": 16.0
          }
        }
      ]
    }
  ]
}
```

---

## ğŸ“ æ­¦å™¨å±æ€§æˆé•¿è®¡ç®—

### è®¡ç®—å…¬å¼ï¼ˆå‚è€ƒåŸé¡¹ç›® libs/zzz/stats/src/wengine.tsï¼‰

æ­¦å™¨å±æ€§ä¼šéšç€ç­‰çº§æå‡å’Œçªç ´è€Œå¢é•¿ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

#### 1. çªç ´ç­‰çº§è®¡ç®—

```python
ascension = min(level // 10, 5)
```

- æ¯æ»¡10çº§å¯ä»¥çªç ´ä¸€æ¬¡
- æœ€é«˜çªç ´ç­‰çº§ä¸º5ï¼ˆå¯¹åº”60çº§ï¼‰

#### 2. æ”»å‡»åŠ›æˆé•¿è®¡ç®—

```python
atk = base_atk * (1 + rate[level] / 10000 + 0.8922 * ascension)
```

**å‚æ•°è¯´æ˜**:
- `base_atk`: åŸºç¡€æ”»å‡»åŠ›ï¼ˆä»åŸå§‹æ•°æ®çš„ `BaseProperty.Value`ï¼‰
- `rate[level]`: ç­‰çº§æˆé•¿ç³»æ•°ï¼ˆä»åŸå§‹æ•°æ®çš„ `Level[level].Rate`ï¼‰
- `0.8922`: çªç ´åŠ æˆç³»æ•°ï¼ˆæ¯æ¬¡çªç ´å¢åŠ 8.922%ï¼‰

**ç¤ºä¾‹**ï¼ˆ14136 ç´¢é­‚å½±çœ¸ 60çº§ï¼‰:
- åŸºç¡€æ”»å‡»åŠ›: 48
- 60çº§æˆé•¿ç³»æ•°: 94090
- çªç ´ç­‰çº§: 5

```python
atk = 48 * (1 + 94090 / 10000 + 0.8922 * 5)
    = 48 * (1 + 9.4090 + 4.4610)
    = 48 * 14.8700
    = 713.76 â‰ˆ 713 âœ“
```

#### 3. å‰¯è¯æ¡æˆé•¿è®¡ç®—

```python
stat = stat_base * (1 + 0.3 * ascension)
```

**å‚æ•°è¯´æ˜**:
- `stat_base`: å‰¯å±æ€§åŸºç¡€å€¼ï¼ˆä»åŸå§‹æ•°æ®çš„ `RandProperty.Value`ï¼Œç™¾åˆ†æ¯”éœ€é™¤ä»¥100ï¼‰
- `0.3`: çªç ´åŠ æˆç³»æ•°ï¼ˆæ¯æ¬¡çªç ´å¢åŠ 30%ï¼‰

**ç¤ºä¾‹**ï¼ˆ14136 ç´¢é­‚å½±çœ¸ 60çº§ï¼‰:
- åŸºç¡€æš´å‡»ç‡: 9.6%ï¼ˆåŸå§‹å€¼960 Ã· 100ï¼‰
- çªç ´ç­‰çº§: 5

```python
crit = 9.6 * (1 + 0.3 * 5)
     = 9.6 * 2.5
     = 24.0% âœ“
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. åªç”Ÿæˆç‰¹æ•ˆbuffå’Œdebuff

**ä¸ç”Ÿæˆ**ï¼š
- âŒ base_property
- âŒ rand_property
- âŒ level_data
- âŒ star_data

**åªç”Ÿæˆ**ï¼š
- âœ… æ­¦å™¨åŸºæœ¬ä¿¡æ¯ï¼ˆid, name, code_name, rarity, weapon_typeï¼‰
- âœ… å¤©èµ‹æ•ˆæœï¼ˆtalents + buffsï¼‰

### 2. å¿…é¡»åŒ…å«targetå­—æ®µ

**é»˜è®¤å€¼**ï¼š
- æ­¦å™¨BUFFé»˜è®¤åªå¯¹è£…å¤‡è€…è‡ªèº«ç”Ÿæ•ˆï¼š`target_self = true, target_enemy = false, target_teammate = false, target_bund = false`

**ç‰¹æ®Šæƒ…å†µ**ï¼š
- å¦‚æœå¤©èµ‹æ•ˆæœæåˆ°"æ•Œäººé˜²å¾¡é™ä½"ï¼Œåˆ™è®¾ç½® `target_enemy = true`
- å¦‚æœå¤©èµ‹æ•ˆæœæåˆ°"å…¨é˜Ÿè§’è‰²"ï¼Œåˆ™è®¾ç½® `target_teammate = true`

**ç¤ºä¾‹**ï¼š
```json
{
  "target": {
    "target_self": true,
    "target_enemy": true,  // å¯¹æ•Œäººç”Ÿæ•ˆï¼ˆå‡é˜²æ•ˆæœï¼‰
    "target_teammate": false,
    "target_bund": false
  }
}
```

### 2. æ¯ä¸ªæ•ˆæœåˆ›å»ºç‹¬ç«‹çš„buff

å¤©èµ‹æè¿°ä¸­çš„æ¯ä¸ªç‹¬ç«‹æ•ˆæœéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„buffå¯¹è±¡ã€‚

**é”™è¯¯ç¤ºä¾‹**ï¼š
```json
"buffs": [
  {
    "id": "14136_talent_1_1_1",
    "name": "æ•é£å¯»è¸ª",
    "in_combat_stats": {
      "DEF_RED_": 25.0,
      "IMPACT_DMG_": 4.0  // âŒ é”™è¯¯ï¼åº”è¯¥æ‹†åˆ†æˆä¸¤ä¸ªbuff
    }
  }
]
```

**æ­£ç¡®ç¤ºä¾‹**ï¼š
```json
"buffs": [
  {
    "id": "14136_talent_1_1_1",
    "name": "ç´¢é­‚å½±çœ¸-å‡é˜²",
    "in_combat_stats": {
      "DEF_RED_": 25.0
    }
  },
  {
    "id": "14136_talent_1_3_1",
    "name": "ç´¢é­‚å½±çœ¸-å†²å‡»åŠ›",
    "in_combat_stats": {
      "IMPACT_DMG_": 4.0
    }
  }
]
```

### 3. å¤šæŠ€èƒ½ä¼¤å®³æå‡æ”¾åœ¨åŒä¸€ä¸ªbuff

å½“ä¸€ä¸ªbuffåŒæ—¶æå‡å¤šä¸ªæŠ€èƒ½çš„ä¼¤å®³æ—¶ï¼Œ**åº”è¯¥å°†è¿™äº›ä¼¤å®³åŠ æˆæ”¾åœ¨åŒä¸€ä¸ªbuffçš„ `in_combat_stats` é‡Œ**ã€‚

**é”™è¯¯ç¤ºä¾‹**ï¼š
```json
"buffs": [
  {
    "in_combat_stats": {
      "NORMAL_ATK_DMG_": 16.0
    }
  },
  {
    "in_combat_stats": {
      "DASH_ATK_DMG_": 16.0
    }
  },
  {
    "in_combat_stats": {
      "DODGE_COUNTER_DMG_": 16.0
    }
  }
]
```

**æ­£ç¡®ç¤ºä¾‹**ï¼š
```json
"buffs": [
  {
    "in_combat_stats": {
      "NORMAL_ATK_DMG_": 16.0,
      "DASH_ATK_DMG_": 16.0,
      "DODGE_COUNTER_DMG_": 16.0
    }
  }
]
```

### 4. æ­£ç¡®è®¾ç½®å åŠ æ¨¡å¼

**çº¿æ€§å åŠ **ï¼š
- æ¯å±‚æä¾›å›ºå®šåŠ æˆ
- æ»¡å±‚æ—¶é¢å¤–åŠ æˆ
- è®¾ç½® `stack_mode: "linear"`

**ä»…æ»¡å±‚ç”Ÿæ•ˆ**ï¼š
- åªæœ‰æ»¡å±‚æ‰ç”Ÿæ•ˆ
- è®¾ç½® `stack_mode: "full_only"`

### 5. æ­£ç¡®è®¾ç½®max_stacks

- éœ€è¦ä»æè¿°ä¸­æå–æœ€å¤§å±‚æ•°
- "æœ€å¤šå åŠ 3å±‚" â†’ `max_stacks: 3`
- "æœ€å¤šå åŠ 2å±‚" â†’ `max_stacks: 2`

### 6. å±æ€§ç±»å‹å¿…é¡»ä½¿ç”¨PropertyTypeæšä¸¾å€¼

æ‰€æœ‰å±æ€§ç±»å‹å¿…é¡»ä½¿ç”¨PropertyTypeæšä¸¾ä¸­å®šä¹‰çš„å€¼ã€‚

**é”™è¯¯ç¤ºä¾‹**:
```json
"in_combat_stats": {
  "ATK_PCT_": 8.0,        // âŒ é”™è¯¯ï¼åº”è¯¥æ˜¯ATK_
  "ANOM_MASTERY_": 25.0,  // âŒ é”™è¯¯ï¼åº”è¯¥æ˜¯ANOM_MAS_
  "CRIT_RATE_": 6.5       // âŒ é”™è¯¯ï¼åº”è¯¥æ˜¯CRIT_
}
```

**æ­£ç¡®ç¤ºä¾‹**:
```json
"in_combat_stats": {
  "ATK_": 8.0,        // âœ… æ­£ç¡®
  "ANOM_MAS_": 25.0,  // âœ… æ­£ç¡®
  "CRIT_": 6.5        // âœ… æ­£ç¡®
}
```

### 7. Debuffå¿…é¡»ä½¿ç”¨æ­£ç¡®çš„å±æ€§ç±»å‹

æ•Œäººçš„debuffï¼ˆå¦‚å‡é˜²ã€æŠ—æ€§é™ä½ï¼‰å¿…é¡»ä½¿ç”¨ä¸“é—¨çš„debuffå±æ€§ç±»å‹ã€‚

**é”™è¯¯ç¤ºä¾‹**:
```json
"in_combat_stats": {
  "DEF_": -25.0  // âŒ é”™è¯¯ï¼è¿™ä¸æ˜¯defé™ä½
}
```

**æ­£ç¡®ç¤ºä¾‹**:
```json
"in_combat_stats": {
  "DEF_RED_": 25.0  // âœ… æ­£ç¡®ï¼šæ•Œäººé˜²å¾¡é™ä½
}
```

### 8. trigger_conditionsæ˜¯æè¿°æ–‡æœ¬

`trigger_conditions` åº”è¯¥æ˜¯æè¿°æ€§æ–‡æœ¬ï¼Œä¸æ˜¯æšä¸¾å€¼ã€‚æš‚æ—¶ä¸å®ç°trigger_conditionsçš„é€»è¾‘åˆ¤æ–­ã€‚

**é”™è¯¯ç¤ºä¾‹**:
```json
"trigger_conditions": ["ADDITIONAL_ATTACK", "ELECTRIC"]  // âŒ é”™è¯¯ï¼è¿™æ˜¯æšä¸¾å€¼
```

**æ­£ç¡®ç¤ºä¾‹**:
```json
"trigger_conditions": "è¿½åŠ æ”»å‡»å‘½ä¸­æ•Œäººå¹¶é€ æˆç”µå±æ€§ä¼¤å®³æ—¶"  // âœ… æ­£ç¡®ï¼šæè¿°æ–‡æœ¬
```

---

## âœ… éªŒè¯æ¸…å•

ç”Ÿæˆåçš„æ•°æ®å¿…é¡»æ»¡è¶³ï¼š

- [ ] ä¸åŒ…å« `base_property` å­—æ®µ
- [ ] ä¸åŒ…å« `rand_property` å­—æ®µ
- [ ] å¤©èµ‹æè¿°ä¸­çš„æ¯ä¸ªæ•ˆæœéƒ½åˆ›å»ºäº†ç‹¬ç«‹çš„buff
- [ ] Buffçš„ `in_combat_stats` å’Œ `out_of_combat_stats` ä½¿ç”¨æ­£ç¡®çš„PropertyType
- [ ] Debuffä½¿ç”¨ä¸“é—¨çš„debuffå±æ€§ç±»å‹ï¼ˆå¦‚ `DEF_RED_`ï¼‰
- [ ] `trigger_conditions` æ˜¯æè¿°æ–‡æœ¬ï¼Œä¸æ˜¯æšä¸¾å€¼
- [ ] å¤šæŠ€èƒ½ä¼¤å®³æå‡æ”¾åœ¨åŒä¸€ä¸ªbuffçš„ `in_combat_stats` é‡Œ
- [ ] `max_stacks` æ­£ç¡®è®¾ç½®ï¼ˆå¦‚æœæ•ˆæœå¯å åŠ ï¼‰
- [ ] `stack_mode` æ­£ç¡®è®¾ç½®ï¼ˆ"linear" æˆ– "full_only"ï¼‰
- [ ] `base_value` æ­£ç¡®è®¾ç½®ï¼ˆçº¿æ€§å åŠ æ¨¡å¼ï¼‰
- [ ] `full_stack_bonus` æ­£ç¡®è®¾ç½®ï¼ˆæ»¡å±‚é¢å¤–åŠ æˆï¼‰
- [ ] `context` æ­£ç¡®è®¾ç½®ï¼ˆIN_COMBAT æˆ– OUT_OF_COMBATï¼‰

---

## ğŸ“š é™„å½•

### PropertyTypeæšä¸¾å€¼å‚è€ƒ

è¯¦è§ `src/zzz_od/application/optimizer/zzz_models/base.py`

### ä½¿ç”¨æ–¹æ³•

```python
from zzz_od.application.optimizer.zzz_models.wengine import WEngine

# ä»åŸå§‹æ•°æ®åŠ è½½æ­¦å™¨
wengine = WEngine.from_dict({
    "wengine_id": "14136",
    "name": "ç´¢é­‚å½±çœ¸",
    "rarity": 4,
    "weapon_type": "å‡»ç ´",
    "base_atk": 48,
    "rand_stat": 9.6,
    "rand_stat_type": "CRIT_",
    "level_data": {...},  # ä»åŸå§‹æ•°æ®è¯»å–
    "talents": [...]
})

# è®¡ç®—æŒ‡å®šç­‰çº§çš„å±æ€§
stats = wengine.get_stats_at_level(level=60, ascension=5)
# è¿”å›: {PropertyType.ATK_BASE: 713.76, PropertyType.CRIT_: 24.0}

# è®¡ç®—buffåœ¨ä¸åŒå±‚æ•°ä¸‹çš„å€¼
buff = wengine.get_current_talent().buffs[0]
value_1_layer = buff.calculate_value(current_stacks=1)  # 4.0%
value_3_layers = buff.calculate_value(current_stacks=3)  # 20.0%
```